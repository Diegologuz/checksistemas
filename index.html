<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check List Soporte</title>
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
        }

        h1 {
            text-align: center;
        }

        .form-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 0 auto;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }

        input, textarea, canvas {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        button {
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #218838;
        }

        .signature-canvas {
            border: 1px solid #ddd;
        }

        .confirmation-message {
            display: none;
            background-color: #28a745;
            color: white;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h1>Check List Soporte</h1>
        
        <form id="checklist-form">
            <!-- Datos Generales -->
            <label for="fecha">Fecha:</label>
            <input type="text" id="fecha" name="fecha" readonly />

            <label for="sucursal">Sucursal:</label>
            <input type="text" id="sucursal" name="sucursal" />

            <label for="clave_sucursal">Clave de Sucursal:</label>
            <input type="text" id="clave_sucursal" name="clave_sucursal" />

            <label for="ubicacion">Ubicación (Detectada):</label>
            <input type="text" id="ubicacion" name="ubicacion" readonly />

            <label for="puesto">Puesto:</label>
            <input type="text" id="puesto" name="puesto" />

            <label for="telefono">Teléfono:</label>
            <input type="text" id="telefono" name="telefono" />

            <label for="nombre">Nombre:</label>
            <input type="text" id="nombre" name="nombre" />

            <!-- Firma Digital -->
            <label>Firma del Gerente:</label>
            <canvas id="firma-gerente" class="signature-canvas" width="500" height="150"></canvas>
            <button type="button" onclick="clearCanvas('firma-gerente')">Limpiar Firma</button>

            <label>Firma del Ingeniero de Sistemas:</label>
            <canvas id="firma-ingeniero" class="signature-canvas" width="500" height="150"></canvas>
            <button type="button" onclick="clearCanvas('firma-ingeniero')">Limpiar Firma</button>

            <!-- Campos para correos electrónicos -->
            <label for="correo1">Correo electrónico 1:</label>
            <input type="email" id="correo1" name="correo1" required />

            <label for="correo2">Correo electrónico 2:</label>
            <input type="email" id="correo2" name="correo2" />

            <label for="correo3">Correo electrónico 3:</label>
            <input type="email" id="correo3" name="correo3" />

            <!-- Botón para Enviar -->
            <button type="button" onclick="sendEmail()">Enviar por Correo</button>
        </form>

        <!-- Mensaje de confirmación -->
        <div id="confirmation-message" class="confirmation-message">
            Información enviada correctamente.
        </div>
    </div>

    <script>
        // Inicializar EmailJS
        emailjs.init("TU_USER_ID");  // Reemplaza con tu ID de usuario de EmailJS

        // Cargar la fecha actual
        document.getElementById('fecha').value = new Date().toLocaleDateString();

        // Función para obtener la ubicación del usuario
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;

                    // Mostrar las coordenadas en el campo "ubicacion"
                    document.getElementById('ubicacion').value = `Lat: ${lat}, Lon: ${lon}`;
                });
            } else {
                alert("Geolocalización no disponible en tu navegador.");
            }
        }

        window.onload = getLocation;

        // Inicializar el canvas para la firma
        function initSignatureCanvas(id) {
            const canvas = document.getElementById(id);
            const context = canvas.getContext('2d');

            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;

            // Configuración para el color y grosor de la firma
            context.lineWidth = 2;
            context.lineJoin = 'round';
            context.lineCap = 'round';
            context.strokeStyle = '#000000';  // Color negro

            // Función para obtener las coordenadas exactas dentro del canvas
            function getMousePos(event) {
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                return { x, y };
            }

            // Funciones para manejar el dibujo
            canvas.addEventListener('mousedown', (e) => {
                isDrawing = true;
                const pos = getMousePos(e);
                lastX = pos.x;
                lastY = pos.y;
            });

            canvas.addEventListener('mousemove', (e) => {
                if (!isDrawing) return;
                const pos = getMousePos(e);
                const currentX = pos.x;
                const currentY = pos.y;

                context.beginPath();
                context.moveTo(lastX, lastY);
                context.lineTo(currentX, currentY);
                context.stroke();

                lastX = currentX;
                lastY = currentY;
            });

            canvas.addEventListener('mouseup', () => {
                isDrawing = false;
            });

            canvas.addEventListener('mouseout', () => {
                isDrawing = false;
            });
        }

        // Limpiar el canvas de firma
        function clearCanvas(id) {
            const canvas = document.getElementById(id);
            const context = canvas.getContext('2d');
            context.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Obtener la firma en formato base64
        function getSignature(id) {
            const canvas = document.getElementById(id);
            return canvas.toDataURL();  // Obtiene la firma en formato base64
        }

        // Enviar el formulario por Email usando EmailJS
        function sendEmail() {
            const formData = new FormData(document.getElementById('checklist-form'));

            // Obtener las firmas
            const firmaGerente = getSignature('firma-gerente');
            const firmaIngeniero = getSignature('firma-ingeniero');

            formData.append('firma_gerente', firmaGerente);
            formData.append('firma_ingeniero', firmaIngeniero);

            // Obtener los correos electrónicos
            const correo1 = document.getElementById('correo1').value;
            const correo2 = document.getElementById('correo2').value;
            const correo3 = document.getElementById('correo3').value;

            const correos = [correo1, correo2, correo3].filter(correo => correo); // Filtrar vacíos

            // Enviar los correos usando EmailJS
            correos.forEach(correo => {
                formData.append('email', correo);  // Añadir los correos al formulario

                emailjs.sendForm('TU_SERVICE_ID', 'TU_TEMPLATE_ID', formData)
                    .then(function(response) {
                        // Mostrar mensaje de confirmación
                        document.getElementById('confirmation-message').style.display = 'block';
                    }, function(error) {
                        alert(`Error al enviar el correo a ${correo}: ` + error.text);
                    });
            });
        }

        // Inicializa el canvas para la firma de Gerente y el Ingeniero
        window.onload = function() {
            getLocation();  // Obtener la ubicación
            initSignatureCanvas('firma-gerente');  // Inicializar canvas para Gerente
            initSignatureCanvas('firma-ingeniero');  // Inicializar canvas para Ingeniero
        }
    </script>
</body>
</html>

